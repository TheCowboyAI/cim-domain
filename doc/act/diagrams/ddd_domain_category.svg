<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 980 520" width="980" height="520">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#374151" />
    </marker>
    <style><![CDATA[
      .node { fill: #f8fafc; stroke: #1f2937; stroke-width: 1.2; rx: 8; ry: 8; }
      .agg { fill: #ecfeff; stroke: #0891b2; }
      .evt { fill: #fef3c7; stroke: #b45309; }
      .cmd { fill: #eef2ff; stroke: #3730a3; }
      .sm  { fill: #f0fdf4; stroke: #16a34a; }
      .label { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 14px; fill: #111827; }
      .title { font-size: 18px; font-weight: 600; }
      .edge { stroke: #374151; stroke-width: 1.6; fill: none; marker-end: url(#arrow); }
      .dashed { stroke-dasharray: 6 6; }
    ]]></style>
  </defs>

  <text x="20" y="28" class="label title">cim-domain as a Category for DDD</text>

  <!-- Objects -->
  <rect x="60"  y="120" width="220" height="64" class="node cmd" />
  <text x="80" y="158" class="label">Command (cqrs::Command)</text>

  <rect x="360" y="60"  width="220" height="64" class="node sm" />
  <text x="380" y="98" class="label">StateMachine (state_machine)</text>

  <rect x="360" y="180" width="220" height="64" class="node agg" />
  <text x="380" y="218" class="label">Aggregate (AggregateRoot)</text>

  <rect x="660" y="120" width="240" height="64" class="node evt" />
  <text x="680" y="158" class="label">DomainEvent (events::DomainEvent)</text>

  <!-- Morphisms -->
  <path class="edge" d="M280,152 C320,152 340,152 360,152" />
  <text x="290" y="142" class="label">handle_command</text>

  <path class="edge" d="M470,124 C500,124 560,124 660,152" />
  <text x="520" y="110" class="label">decide → events</text>

  <path class="edge" d="M660,188 C580,216 540,232 470,212" />
  <text x="560" y="230" class="label">fold(events)</text>

  <!-- Commutative triangle annotation -->
  <text x="120" y="320" class="label">Law: fold ∘ decide ∘ handle = transition</text>
  <text x="120" y="345" class="label">Associativity: fold(e3 ∘ (e2 ∘ e1)) = fold((e3 ∘ e2) ∘ e1)</text>

  <!-- Legend -->
  <g transform="translate(60,380)">
    <rect width="840" height="110" fill="#f9fafb" stroke="#e5e7eb" />
    <text x="12" y="24" class="label">Objects: Command, Aggregate, DomainEvent, StateMachine</text>
    <text x="12" y="48" class="label">Morphisms: handle_command (Kleisli Result), decide→events (Transformation), fold(events) (Free Monoid Fold)</text>
    <text x="12" y="72" class="label">Identity: no-op event; Composition: event concatenation</text>
    <text x="12" y="96" class="label">This is the DDD core proof: all paths commute to the same state</text>
  </g>
</svg>
