<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="520" viewBox="0 0 1200 520">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,3 L0,6 Z" fill="#374151" />
    </marker>
    <style><![CDATA[
      .title { font-family: ui-sans-serif, system-ui; font-size: 18px; font-weight: 600; fill: #111827; }
      .label { font-family: ui-sans-serif, system-ui; font-size: 13px; fill: #111827; }
      .cmd { fill: #fffbeb; stroke: #f59e0b; stroke-width: 1.2; rx: 8; ry: 8; }
      .qry { fill: #ecfeff; stroke: #06b6d4; stroke-width: 1.2; rx: 8; ry: 8; }
      .env { fill: #f5f3ff; stroke: #7c3aed; stroke-width: 1.2; rx: 8; ry: 8; }
      .vo { fill: #eef2ff; stroke: #6366f1; stroke-width: 1.2; rx: 8; ry: 8; }
      .edge { stroke: #374151; stroke-width: 1.3; fill: none; marker-end: url(#arrow); }
      .edge-corr { stroke: #0ea5e9; stroke-dasharray: 5 4; }
      .edge-temp { stroke: #ef4444; stroke-dasharray: 3 3; }
    ]]></style>
  </defs>

  <text x="16" y="28" class="title">Envelopes and Message Identity</text>

  <!-- Command side -->
  <rect x="32" y="90" width="140" height="40" class="cmd" />
  <text x="44" y="114" class="label">Command</text>
  <rect x="200" y="80" width="200" height="46" class="env" />
  <text x="212" y="108" class="label">CommandEnvelope</text>
  <rect x="430" y="80" width="140" height="46" class="vo" />
  <text x="442" y="108" class="label">CommandId</text>
  <rect x="430" y="140" width="200" height="46" class="vo" />
  <text x="442" y="168" class="label">MessageIdentity</text>
  <rect x="660" y="100" width="150" height="36" class="vo" />
  <text x="672" y="124" class="label">CorrelationId</text>
  <rect x="660" y="142" width="150" height="36" class="vo" />
  <text x="672" y="166" class="label">CausationId</text>
  <rect x="660" y="184" width="120" height="36" class="vo" />
  <text x="672" y="208" class="label">EventId</text>
  <path class="edge" d="M172,104 C184,104 192,104 200,104" />
  <text x="160" y="92" class="label">encloses</text>
  <path class="edge" d="M400,104 C410,104 418,104 430,104" />
  <text x="372" y="92" class="label">has_id</text>
  <path class="edge" d="M400,104 C410,124 418,144 430,163" />
  <text x="372" y="148" class="label">has_identity</text>
  <path class="edge" d="M630,118 C640,118 646,118 660,118" />
  <text x="588" y="110" class="label">has_correlation_id</text>
  <path class="edge" d="M630,160 C640,160 646,160 660,160" />
  <text x="594" y="154" class="label">has_causation_id</text>
  <path class="edge" d="M630,200 C640,200 646,200 660,200" />
  <text x="572" y="192" class="label">has_event_message_id</text>

  <!-- Event envelope identities on right -->
  <rect x="200" y="260" width="220" height="46" class="env" />
  <text x="212" y="288" class="label">DomainEventEnvelope</text>
  <rect x="450" y="260" width="120" height="40" class="vo" />
  <text x="462" y="284" class="label">EventId</text>
  <rect x="580" y="260" width="140" height="40" class="vo" />
  <text x="592" y="284" class="label">EntityId</text>
  <rect x="730" y="260" width="150" height="40" class="vo" />
  <text x="742" y="284" class="label">CorrelationId</text>
  <rect x="900" y="260" width="140" height="40" class="vo" />
  <text x="912" y="284" class="label">CausationId</text>
  <rect x="1060" y="260" width="160" height="40" class="vo" />
  <text x="1072" y="284" class="label">PayloadMetadata</text>
  <path class="edge" d="M420,260 C420,240 410,230 380,230 350,230 300,242 280,260" />
  <text x="300" y="242" class="label">correlates_to</text>
  <path class="edge" d="M420,104 C500,200 560,220 700,240" />
  <text x="520" y="210" class="label">correlates_to</text>
  <path class="edge" d="M420,286 C430,286 440,286 450,286" />
  <text x="430" y="276" class="label">has_event_id</text>
  <path class="edge" d="M420,286 C480,300 520,300 580,286" />
  <text x="488" y="318" class="label">has_aggregate_id</text>
  <path class="edge" d="M420,286 C540,310 600,310 730,286" />
  <text x="536" y="332" class="label">has_correlation_id</text>
  <path class="edge" d="M420,286 C660,322 800,322 900,286" />
  <text x="620" y="350" class="label">has_causation_id</text>
  <path class="edge" d="M420,286 C720,338 920,338 1060,286" />
  <text x="680" y="370" class="label">has_payload_metadata</text>

  <!-- Query side -->
  <rect x="32" y="360" width="120" height="40" class="qry" />
  <text x="44" y="384" class="label">Query</text>
  <rect x="200" y="350" width="200" height="46" class="env" />
  <text x="212" y="378" class="label">QueryEnvelope</text>
  <rect x="430" y="350" width="120" height="46" class="vo" />
  <text x="442" y="378" class="label">QueryId</text>
  <path class="edge" d="M152,374 C168,374 184,374 200,374" />
  <text x="156" y="364" class="label">encloses</text>
  <path class="edge" d="M400,374 C410,374 418,374 430,374" />
  <text x="372" y="364" class="label">has_id</text>
  <path class="edge edge-corr" d="M300,350 C360,320 520,300 800,286" />
  <text x="560" y="300" class="label">correlates_to</text>

  <!-- Acknowledgements -->
  <rect x="32" y="160" width="220" height="36" class="vo" />
  <text x="44" y="184" class="label">CommandAcknowledgment</text>
  <path class="edge" d="M132,126 C132,138 132,148 142,160" />
  <text x="90" y="150" class="label">acknowledged_by</text>
  <rect x="430" y="420" width="200" height="36" class="vo" />
  <text x="442" y="444" class="label">QueryAcknowledgment</text>
  <path class="edge" d="M300,374 C340,398 380,414 430,420" />
  <text x="336" y="408" class="label">acknowledged_by</text>

  <!-- Temporal relation -->
  <path class="edge edge-temp" d="M820,240 C840,220 860,220 880,240" />
  <text x="832" y="214" class="label">precedes</text>

</svg>

