<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 980 520" width="980" height="520">
  <defs>
    <style><![CDATA[
      .agg { fill: #ecfeff; stroke: #0891b2; stroke-width: 1.4; rx: 10; ry: 10; }
      .box { fill: #f8fafc; stroke: #64748b; stroke-width: 1.1; rx: 8; ry: 8; }
      .label { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; font-size: 14px; fill: #111827; }
      .title { font-size: 18px; font-weight: 600; }
      .edge { stroke: #374151; stroke-width: 1.2; fill: none; }
    ]]></style>
  </defs>

  <text x="20" y="28" class="label title">Aggregate Composition in cim-domain</text>

  <!-- Aggregate container -->
  <rect x="60" y="60" width="860" height="400" class="agg" />
  <text x="80" y="90" class="label">AggregateRoot (EntityId<T>, invariants, state machine)</text>

  <!-- Components -->
  <rect x="100" y="120" width="220" height="70" class="box" />
  <text x="120" y="160" class="label">EntityId<T> (identity)</text>

  <rect x="360" y="120" width="260" height="70" class="box" />
  <text x="380" y="160" class="label">Value Objects (invariants)</text>

  <rect x="660" y="120" width="220" height="70" class="box" />
  <text x="680" y="160" class="label">StateMachine (Mealy/Moore)</text>

  <rect x="100" y="230" width="340" height="70" class="box" />
  <text x="120" y="270" class="label">Commands (cqrs::Command)</text>

  <rect x="480" y="230" width="300" height="70" class="box" />
  <text x="500" y="270" class="label">DomainEvent (events::DomainEvent)</text>

  <rect x="100" y="340" width="280" height="70" class="box" />
  <text x="120" y="380" class="label">Invariants (compile-time + runtime)</text>

  <rect x="420" y="340" width="460" height="70" class="box" />
  <text x="440" y="380" class="label">Event Fold (associative, identity = no-op)</text>

  <!-- Notes -->
  <text x="80" y="480" class="label">Why composed: Aggregates encapsulate identity, invariants, and state machines; commands decide events; events fold back to state.</text>
</svg>
